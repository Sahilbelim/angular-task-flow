<div class="min-h-screen bg-gradient-to-br from-blue-100 via-sky-100 to-indigo-200">

    <div class="w-full max-w-7xl mx-auto p-6">

        <!-- STATS -->
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6 mb-6">

            <div class="bg-white/90 rounded-2xl border border-blue-100 p-6">
                <p class="text-sm text-blue-600">Total Users</p>
                <h3 class="text-3xl font-extrabold">{{ totalUsers }}</h3>
            </div>

            <div class="bg-white/90 rounded-2xl border border-blue-100 p-6">
                <p class="text-sm text-orange-400">Admins</p>
                <h3 class="text-3xl font-extrabold">
                    {{ adminCount }}
                </h3>
            </div>

            <div class="bg-white/90 rounded-2xl border border-blue-100 p-6">
                <p class="text-sm text-gray-500">Normal Users</p>
                <h3 class="text-3xl font-extrabold">
                    {{ normalUserCount }}
                </h3>
            </div>

        </div>

        <!-- TABLE CARD -->
        <div class="bg-white/90 backdrop-blur-xl rounded-2xl border border-blue-100 p-6 shadow">

            <!-- FILTER BAR -->
            <div class="flex flex-col md:flex-row gap-3 md:items-center md:justify-between border-b pb-4">

                <input type="text" placeholder="Search by name or email" [(ngModel)]="searchText"
                    (ngModelChange)="filterBySearch()"
                    class="h-12 w-full md:w-2/3 rounded-xl border border-blue-200 bg-blue-50 px-4 focus:ring-2 focus:ring-blue-500" />

                <select [(ngModel)]="selectedPageSize" (ngModelChange)="onPageSizeChange($event)"
                    class="h-12 w-full md:w-40 rounded-xl border border-blue-200 bg-white px-4">
                    @for (size of pageSizeOptions; track $index) {
                    <option [value]="size">{{ size }}</option>
                    }
                </select>

                <button (click)="openAdd()" class="h-12 min-w-[120px] rounded-xl bg-gradient-to-r from-blue-600 to-indigo-600
                 text-white font-semibold shadow hover:scale-105 transition">
                    Add User
                </button>

            </div>

            <!-- TABLE -->
            <div class="overflow-x-auto mt-4">
                <table class="min-w-[800px] w-full text-sm">

                    <thead>
                        <tr class="border-b">
                            <th class="p-3 text-left">User</th>
                            <th class="p-3 text-center">Email</th>
                            <th class="p-3 text-center">Permissions</th>
                            <th class="p-3 text-left">Action</th>
                        </tr>
                    </thead>

                    <tbody>
                        @for (user of filteredUsers | paginate:
                        { itemsPerPage: itemsPerPage, currentPage: p };
                        track user.id) {

                        <tr class="border-b hover:bg-blue-50">

                            <td class="p-3 flex items-center gap-3">
                                <img [src]="user.avatar || 'https://i.pravatar.cc/40'" class="w-9 h-9 rounded-full" />
                                <span class="font-medium">{{ user.name }}</span>
                            </td>

                            <td class="p-3 text-center">{{ user.email }}</td>

                            <td class="p-3 text-center text-xs text-gray-600">
                                {{ user.permissions?.createUser ? 'Manage Users' : 'Limited' }}
                            </td>

                            <td class="p-3 flex gap-4">
                                <button (click)="openEdit(user)" class="text-blue-600 hover:underline">
                                    Edit
                                </button>

                                <button (click)="deleteUser(user)" class="text-red-500 hover:underline">
                                    Delete
                                </button>
                            </td>

                        </tr>
                        }
                    </tbody>

                </table>
            </div>

            <!-- PAGINATION -->
            <div class="mt-4 flex justify-between items-center">
                <p class="text-sm text-blue-600">
                    Total: {{ filteredUsers.length }}
                </p>

                <pagination-controls (pageChange)="p = $event" previousLabel="Prev" nextLabel="Next">
                </pagination-controls>
            </div>

        </div>
    </div>

    <!-- BACKDROP -->
    @if (sidebarOpen) {
    <div (click)="closeSidebar()" class="fixed inset-0 bg-black/40 backdrop-blur-sm z-40">
    </div>

    <!-- SIDEBAR -->
    <div class="fixed top-0 right-0 h-full w-full sm:w-[420px]
             bg-white z-50 shadow-2xl
             transform transition-transform duration-300 animate-[slideIn_0.3s_ease-out]">

        <app-admin-add-user [editUser]="editUser" (close)="closeSidebar()">
        </app-admin-add-user>

    </div>
    }
</div>